<html>

<head>
    <title>Dux Avatar Demo</title>
    <style>
        /* Basic styling for the Dux image */
        #background {
            position: fixed;
            top: 20%;
            left: 20%;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 1px;
            align-items: center;



            width: 70%;
            height: 70vh;
            background-image: url('background.png');
            background-size: cover;
            background-position: center;
            border: #6b055a solid 2px;
            z-index: 9999;



           
            overflow: hidden;
           
        }

        #dux {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            /* border: 2px solid #ccc;
                padding: 1px;
                background-color: #f0f0f0; */
            display: grid;
            grid-column: -1/-2;
            grid-row: -2/-1;
            z-index: 1;
            cursor: move;
        }

       /* Image box styles */
#image-box {
    position: relative;
    display: inline-block;
}

/* Handle styles */
.imageHandle {
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: #0e4e46;
    z-index: 10;
    opacity: 0;
}

#image-box:hover .imageHandle{
opacity: 1;
}



/* Corner handles */
#nw { top: -4px; left: -4px; cursor: nw-resize; }
#ne { top: -4px; right: -4px; cursor: ne-resize; }
#sw { bottom: -4px; left: -4px; cursor: sw-resize; }
#se { bottom: -4px; right: -4px; cursor: se-resize; }

/* Edge handles */
#n { top: -4px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
#s { bottom: -4px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
#e { top: 50%; right: -4px; transform: translateY(-50%); cursor: e-resize; }
#w { top: 50%; left: -4px; transform: translateY(-50%); cursor: w-resize; }




        #draggable-resizable-box {
            /* grid-column: -1/-4;
            grid-row: -4/-1; */
            position: absolute;
           
            width: 300px;
            height: 200px;
            background-color: #fdeca6;
            /* border: 2px solid #000; */
            cursor: move;
            resize: none;
            /* To disable native resize */
            transition: 300ms padding;
        }


        /* Resizable handles using data attributes */
        #draggable-resizable-box [data-resize] {
            background-color: #0e4e46;
            position: absolute;
            width: 6px;
            height: 6px;
            z-index: 4;
            opacity: 0;

            transition: 300ms all;
        }

        #draggable-resizable-box:hover [data-resize] {
            opacity: 1;
        }

        #draggable-resizable-box:hover {
            cursor: all-scroll;

            padding: 1px;
            border: 1px solid #081b2d;

        }


        /* Positioning the resize handles at the corners and edges */
        [data-resize="nw"] {
            top: -4px;
            left: -4px;
            cursor: nw-resize;
            margin: 4;
        }

        [data-resize="ne"] {
            top: -4px;
            right: -4px;
            cursor: ne-resize;
        }

        [data-resize="sw"] {
            bottom: -4px;
            left: -4px;
            cursor: sw-resize;
        }

        [data-resize="se"] {
            bottom: -4px;
            right: -4px;
            cursor: se-resize;
        }

        [data-resize="n"] {
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            cursor: n-resize;
        }

        [data-resize="s"] {
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            cursor: s-resize;
        }

        [data-resize="e"] {
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            cursor: e-resize;
        }

        [data-resize="w"] {
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            cursor: w-resize;
        }

        #talk-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 600px;
            z-index: 2;
        }

        #talk-box-header {
            background-color: #f0f0f0;
            padding: 5px;
            border-bottom: 1px solid #ccc;
            cursor: move;
            height: 73px;
        }

        /* Styling for draggable and resizable div */


        /*text */

        #text-box {
            position: absolute;
            top: 30%;
            left: 30%;
            /* width: 300px;
            height: 100px; */
            padding: 13px;

            background-color: transparent;
            border: 2px solid #fafafa;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            /* Initial font size */
            text-align: center;
            resize: none;
            /* To disable native resize */
            z-index: 19;
            border: none;

            transition: 300ms padding;
        }

        #text-box:hover {
            cursor: all-scroll;
            padding: 20px;
            /* border: 1px solid #081b2d; */

        }

        #text-box .resize-handle {
            margin: 8;
            opacity: 0;
            transition: 300ms all;
        }

        #text-box:hover .resize-handle {
            opacity: 1;
            margin: 8;
        }

        .resize-handle {
            position: absolute;
            width: 7px;
            height: 7px;
            background-color: #06615c;
            z-index: 4;
        }

        [contenteditable]:focus {
            outline: 0px solid transparent;
        }

        #text-content {

            border-radius: 70%;
        }

        /* Positioning the resize handles */
        /* .resize-handle.nw1 { top: -4px; left: -4px; cursor: nw-resize; }
        .resize-handle.ne1 { top: -4px; right: -4px; cursor: ne-resize; }
        .resize-handle.sw1 { bottom: -4px; left: -4px; cursor: sw-resize; }
        .resize-handle.se1 { bottom: -4px; right: -4px; cursor: se-resize; } */




        /*end of text resize handle */


        /* image */


        .resize-handle {
    position: absolute;
    width: 5px; /* Adjust size as needed */
    height: 5px;
    background-color: #081b2d;
    z-index: 4;
    margin: -5px; /* Offset for better placement */
}

/* Positioning the resize handles */
.resize-handle.nw {
    top: -5px;
    left: -5px;
    cursor: nw-resize;
}

.resize-handle.ne {
    top: -5px;
    right: -5px;
    cursor: ne-resize;
}

.resize-handle.sw {
    bottom: -5px;
    left: -5px;
    cursor: sw-resize;
}

.resize-handle.se {
    bottom: -5px;
    right: -5px;
    cursor: se-resize;
}

.resize-handle.n {
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    cursor: n-resize;
}

.resize-handle.s {
    bottom: -5px;
    left: 50%;
    transform: translateX(-50%);
    cursor: s-resize;
}

.resize-handle.e {
    top: 50%;
    right: -5px;
    transform: translateY(-50%);
    cursor: e-resize;
}

.resize-handle.w {
    top: 50%;
    left: -5px;
    transform: translateY(-50%);
    cursor: w-resize;
}


        #image-content {
            /* display: grid;
            grid-column: -5/-3;
            width: 200%; /* Set smaller default width */
            /* Set smaller default height */
            width: 100%;
            height: 100%;

        }

        #image-content:hover {
            /* display: grid;
            grid-column: -5/-3;
            width: 200%; /* Set smaller default width */
            /* Set smaller default height */
            border: 1px solid #081b2d;


        }

        #image-box {}

        #speakButton {}


        .clone:hover .clonehandle{


            
            opacity: 1;
            margin: 8;

        }
        .clonehandle {
    background-color: #eaf5f3;
    cursor: pointer;
    opacity: 0;
}
.clonehandle1:hover {
    
}
.clone:hover .resize-handle {
  display: none;
 
}
.clone:hover .dataresize {
  display: none;
  
 
}
.popup{
    /* background-image: url('background.png'); */
    background-color: white;
}
.closepopup:hover{

    transition-timing-function: ease-in;
    transform: scale(0.7);
}







.color-picker-container {
                position: relative;
                display: inline-block;
           width: 100px;
            }
    
         
    
            .color-popup {
                /* display: none; Hide the color input by default */
                opacity: 0;
               
             
              
            }
            

            .color-picker-container{


}
    
           


    </style>
</head>

<body>
    <div id="background">
        <img id="dux" src="images/DuxProHiddle.gif" alt="Dux" style="display:none">



        <div id="talk-box" style="display:none">
            <!-- <div id="talk-box-header" style="background-color:#f7b602">Click here to move</div> -->
            <!-- <textarea rows="2" cols="78" id="talk" placeholder="Type your text here..."></textarea> -->
            <button type="button" id="speakButton" onclick="speakAndChangeImage();">Speak</button><br>
        </div>
        <!-- New draggable and resizable box -->



        <div id="image-box">
            <img src="images/Grid.png" id="image-content" style="cursor: all-scroll;" />
            <!-- Resizable handles -->
            <div id="nw" class="imageHandle"></div>
            <div id="ne" class="imageHandle"></div>
            <div id="sw" class="imageHandle"></div>
            <div id="se" class="imageHandle"></div>
            <div id="n" class="imageHandle"></div>
            <div id="s" class="imageHandle"></div>
            <div id="e" class="imageHandle"></div>
            <div id="w" class="imageHandle"></div>
        </div>
        

      



        <div id="text-box">
            <div id="text-content" style="cursor: auto;" contenteditable="true">I'm Near East Video Editor</div>
            <!-- Resizable handles -->
            <div class="resize-handle nw"></div>
            <div class="resize-handle ne"></div>
            <div class="resize-handle sw"></div>
            <div class="resize-handle se"></div>
            <div class="resize-handle n"></div>
            <div class="resize-handle s"></div>
            <div class="resize-handle e"></div>
            <div class="resize-handle w"></div>
        </div>


        <div id="draggable-resizable-box">
            <div class="dataresize" data-resize="nw"></div>
            <div class="dataresize" data-resize="ne"></div>
            <div class="dataresize" data-resize="sw"></div>
            <div class="dataresize" data-resize="se"></div>
            <div class="dataresize" data-resize="n"></div>
            <div class="dataresize" data-resize="s"></div>
            <div class="dataresize" data-resize="e"></div>
            <div class="dataresize" data-resize="w"></div>
        </div>

        <!-- <div id="colorDisplay1" class="colorDisplay" style="background-color: #0e4e46;width: 34px;">Hello World</div> -->
<div class="color-popup">
    <input type="color" id="color-picker" />
</div>

    </div>





    
    
    <script>
        const box = document.getElementById('draggable-resizable-box');
        const background1 = document.getElementById('background');
        let currentHandle, isResizing = false, isDragging = false;
        let startX, startY, startWidth, startHeight, startTop, startLeft;
    
        const clamp = (value, min, max) => Math.max(min, Math.min(max, value));
    
        const calculateNewDimensions = (dx, dy) => {
            let newWidth = startWidth, newHeight = startHeight;
            let newTop = startTop, newLeft = startLeft;
    
            switch (currentHandle) {
                case 'nw':
                    newWidth -= dx;
                    newHeight -= dy;
                    newLeft += dx;
                    newTop += dy;
                    break;
                case 'ne':
                    newWidth += dx;
                    newHeight -= dy;
                    newTop += dy;
                    break;
                case 'sw':
                    newWidth -= dx;
                    newHeight += dy;
                    newLeft += dx;
                    break;
                case 'se':
                    newWidth += dx;
                    newHeight += dy;
                    break;
                case 'n':
                    newHeight -= dy;
                    newTop += dy;
                    break;
                case 's':
                    newHeight += dy;
                    break;
                case 'e':
                    newWidth += dx;
                    break;
                case 'w':
                    newWidth -= dx;
                    newLeft += dx;
                    break;
            }
    
            // Ensure the new dimensions and positions are within the parent bounds
            const parentRect = background1.getBoundingClientRect();
            newWidth = clamp(newWidth, 20, parentRect.width - newLeft);
            newHeight = clamp(newHeight, 20, parentRect.height - newTop);
            newTop = clamp(newTop, 0, parentRect.height - newHeight);
            newLeft = clamp(newLeft, 0, parentRect.width - newWidth);
    
            return { newWidth, newHeight, newTop, newLeft };
        };
    
        const onMouseMove = (e) => {
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            const parentRect = background1.getBoundingClientRect();
    
            if (isDragging) {
                let newTop = clamp(startTop + dy, 0, parentRect.height - box.offsetHeight);
                let newLeft = clamp(startLeft + dx, 0, parentRect.width - box.offsetWidth);
                box.style.top = `${newTop}px`;
                box.style.left = `${newLeft}px`;
            } else if (isResizing) {
                const { newWidth, newHeight, newTop, newLeft } = calculateNewDimensions(dx, dy);
    
                if (newWidth > 0 && newHeight > 0) {
                    box.style.width = `${clamp(newWidth, 20, parentRect.width - newLeft)}px`;
                    box.style.height = `${clamp(newHeight, 20, parentRect.height - newTop)}px`;
                    box.style.top = `${newTop}px`;
                    box.style.left = `${newLeft}px`;
                }
            }
        };
    
        const onMouseUp = () => {
            isResizing = false;
            isDragging = false;
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        };
    
        const onMouseDown = (e) => {
            const style = getComputedStyle(box);
    
            startX = e.clientX;
            startY = e.clientY;
            startWidth = parseFloat(style.width);
            startHeight = parseFloat(style.height);
            startTop = parseFloat(style.top);
            startLeft = parseFloat(style.left);
    
            if (e.target.dataset.resize) {
                isResizing = true;
                currentHandle = e.target.dataset.resize;
            } else {
                isDragging = true;
            }
    
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        };
    
        const makeDraggableAndResizable1 = (element) => {
            element.addEventListener('mousedown', onMouseDown);
        };
    
        makeDraggableAndResizable1(box);
    </script>
    
    

<script>
    // const duplicateBox = () => {
        //     if (getComputedStyle(box).opacity === "1") {
        //         const newBox = box.cloneNode(true);
        //         newBox.style.position = 'absolute';
        //         newBox.style.top = `${Math.random() * 400}px`;
        //         newBox.style.left = `${Math.random() * 400}px`;
        //         newBox.style.zIndex = '10';
        //         background1.appendChild(newBox);
        //         makeDraggableAndResizable1(newBox);
        //     } else {
        //         console.log("Box opacity is not 1, duplication not allowed.");
        //     }
        // };
    
        // document.addEventListener('keydown', (e) => {
        //     if (e.ctrlKey && e.key === 'd') {
        //         e.preventDefault();
        //         duplicateBox();
        //     }
        // });</script>
    
    <script>
        makeResizable1AndDraggable1(document.getElementById("text-box"));
    
        function makeResizable1AndDraggable1(elmnt) {
            let isResizing = false;
            const background = document.getElementById("background");
    
            dragElement1(elmnt);
            makeResizable1(elmnt);
    
            function dragElement1(elmnt) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    
                elmnt.onmousedown = function (e) {
                    if (!isResizing && e.target !== document.getElementById("text-content")) {
                        dragMouseDown1(e);
                    }
                };
    

    
                function dragMouseDown1(e) {
                    e = e || window.event;
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closedragElement1;
                    document.onmousemove = elementDrag1;
                }
    
                function elementDrag1(e) {
                    e = e || window.event;
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
    
                    let newTop = elmnt.offsetTop - pos2;
                    let newLeft = elmnt.offsetLeft - pos1;
    
                    const backgroundRect = background.getBoundingClientRect();
                    const elmntRect = elmnt.getBoundingClientRect();
    
                    newTop = Math.max(0, Math.min(newTop, backgroundRect.height - elmntRect.height));
                    newLeft = Math.max(0, Math.min(newLeft, backgroundRect.width - elmntRect.width));
    
                    elmnt.style.top = newTop + "px";
                    elmnt.style.left = newLeft + "px";
                }
    
                function closedragElement1() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                }
            }
    
            function makeResizable1(elmnt) {
                const handles = elmnt.querySelectorAll(".resize-handle");
                const content = document.getElementById("text-content");
    
                let initialRect = elmnt.getBoundingClientRect();
                let initialWidth = initialRect.width;
                let initialFontSize = parseInt(window.getComputedStyle(content).fontSize, 10);
    
                handles.forEach(function (handle) {



          

                    handle.addEventListener("mousedown", function (e) {
                        e.preventDefault();
                        isResizing = true;
                        const rect = elmnt.getBoundingClientRect();
                        const initialX = e.clientX;
                        const initialY = e.clientY;
                        const initialBoxWidth = rect.width;
                        const initialBoxHeight = rect.height;
                        const startLeft = elmnt.offsetLeft;
                        const startTop = elmnt.offsetTop;
    
                        document.onmousemove = function (e) {
                            const dx = e.clientX - initialX;
                            const dy = e.clientY - initialY;
    
                            const { newWidth, newHeight, newTop, newLeft } = calculateNewDimensions(dx, dy);
    
                            if (newWidth > 20 && newHeight > 20) {
                                elmnt.style.width = newWidth + "px";
                                elmnt.style.height = newHeight + "px";
                                elmnt.style.top = newTop + "px";
                                elmnt.style.left = newLeft + "px";
    
                                const widthRatio = newWidth / initialWidth;
                                const newFontSize = initialFontSize * widthRatio;
                                content.style.fontSize = newFontSize + "px";
                            }
                        };
    
                        document.onmouseup = function () {
                            document.onmousemove = null;
                            document.onmouseup = null;
                            isResizing = false;
                        };
    
                        function calculateNewDimensions(dx, dy) {
                            let newWidth = initialBoxWidth, newHeight = initialBoxHeight;
                            let newTop = startTop, newLeft = startLeft;
    
                            if (handle.classList.contains("nw")) {
                                newWidth -= dx;
                                newHeight -= dy;
                                newLeft += dx;
                                newTop += dy;
                            } else if (handle.classList.contains("ne")) {
                                newWidth += dx;
                                newHeight -= dy;
                                newTop += dy;
                            } else if (handle.classList.contains("sw")) {
                                newWidth -= dx;
                                newHeight += dy;
                                newLeft += dx;
                            } else if (handle.classList.contains("se")) {
                                newWidth += dx;
                                newHeight += dy;
                            } else if (handle.classList.contains("n")) {
                                newHeight -= dy;
                                newTop += dy;
                            } else if (handle.classList.contains("s")) {
                                newHeight += dy;
                            } else if (handle.classList.contains("e")) {
                                newWidth += dx;
                            } else if (handle.classList.contains("w")) {
                                newWidth -= dx;
                                newLeft += dx;
                            }
    
                            return { newWidth, newHeight, newTop, newLeft };
                        }
                    });
                });
            }
        }
    </script>
    
   
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const imageBox = document.getElementById("image-box");
            const background = document.getElementById("background");
    
            let isDragging = false;
            let isResizing = false;
            let startX, startY, startTop, startLeft, startWidth, startHeight, startHandle;
    
            const clamp = (value, min, max) => Math.min(Math.max(value, min), max);
    
            const calculateNewDimensions = (dx, dy) => {
    let newWidth = startWidth;
    let newHeight = startHeight;
    let newTop = startTop;
    let newLeft = startLeft;

    const parentRect = background.getBoundingClientRect();

    if (startHandle === "nw") {
        newWidth = startWidth - dx;
        newHeight = startHeight - dy;
        newTop = clamp(startTop + dy, 0, startTop + startHeight - 20);
        newLeft = clamp(startLeft + dx, 0, startLeft + startWidth - 20);
    } else if (startHandle === "ne") {
        newWidth = startWidth + dx;
        newHeight = startHeight - dy;
        newTop = clamp(startTop + dy, 0, startTop + startHeight - 20);
    } else if (startHandle === "sw") {
        newWidth = startWidth - dx;
        newHeight = startHeight + dy;
        newLeft = clamp(startLeft + dx, 0, startLeft + startWidth - 20);
    } else if (startHandle === "se") {
        newWidth = startWidth + dx;
        newHeight = startHeight + dy;
    } else if (startHandle === "n") {
        newHeight = startHeight - dy;
        newTop = clamp(startTop + dy, 0, startTop + startHeight - 20);
    } else if (startHandle === "s") {
        newHeight = startHeight + dy;
    } else if (startHandle === "e") {
        newWidth = startWidth + dx;
    } else if (startHandle === "w") {
        newWidth = startWidth - dx;
        newLeft = clamp(startLeft + dx, 0, startLeft + startWidth - 20);
    }

    // Ensure width and height don't cause the box to exceed the parent's bounds
    newWidth = clamp(newWidth, 20, parentRect.width - newLeft);
    newHeight = clamp(newHeight, 20, parentRect.height - newTop);
    newTop = clamp(newTop, 0, parentRect.height - newHeight);
    newLeft = clamp(newLeft, 0, parentRect.width - newWidth);

    return { newWidth, newHeight, newTop, newLeft };
};

    
            const onMouseDown = (e, handleId) => {
                e.preventDefault();
                isResizing = !!handleId;
                isDragging = !handleId;
    
                startX = e.clientX;
                startY = e.clientY;
                startTop = imageBox.offsetTop;
                startLeft = imageBox.offsetLeft;
                startWidth = imageBox.offsetWidth;
                startHeight = imageBox.offsetHeight;
                startHandle = handleId;
    
                document.addEventListener("mousemove", onMouseMove);
                document.addEventListener("mouseup", onMouseUp);
            };
    
            const onMouseMove = (e) => {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
    
                if (isResizing) {
                    const { newWidth, newHeight, newTop, newLeft } = calculateNewDimensions(dx, dy);
                    imageBox.style.width = `${newWidth}px`;
                    imageBox.style.height = `${newHeight}px`;
                    imageBox.style.top = `${newTop}px`;
                    imageBox.style.left = `${newLeft}px`;
                } else if (isDragging) {
                    const parentRect = background.getBoundingClientRect();
                    const newTop = clamp(startTop + dy, 0, parentRect.height - imageBox.offsetHeight);
                    const newLeft = clamp(startLeft + dx, 0, parentRect.width - imageBox.offsetWidth);
                    imageBox.style.top = `${newTop}px`;
                    imageBox.style.left = `${newLeft}px`;
                }
            };
    
            const onMouseUp = () => {
                isDragging = false;
                isResizing = false;
                document.removeEventListener("mousemove", onMouseMove);
                document.removeEventListener("mouseup", onMouseUp);
            };
    
            // Adding drag functionality to the box
            imageBox.addEventListener("mousedown", (e) => {
                if (!e.target.classList.contains("imageHandle")) {
                    onMouseDown(e, null);
                }
            });
    
            // Adding resize handles
            const handles = ['nw', 'ne', 'sw', 'se', 'n', 's', 'e', 'w'];
            handles.forEach((handleId) => {
                const handle = document.getElementById(handleId);
                handle.addEventListener("mousedown", (e) => onMouseDown(e, handleId));
            });
        });
    </script>




    
<script>
    const background = document.getElementById('background');
    let hoveredElement = null;

    // Utility function to make elements draggable and resizable
    const makeDraggableAndResizable = (element) => {
        const clamp = (value, min, max) => Math.max(min, Math.min(max, value));
        let isResizing = false, isDragging = false;
        let startX, startY, startWidth, startHeight, startTop, startLeft;
        let currentHandle;

        const onMouseMove = (e) => {
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            const parentRect = background.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();

            if (isDragging) {
                let newTop = clamp(startTop + dy, 0, parentRect.height - elementRect.height);
                let newLeft = clamp(startLeft + dx, 0, parentRect.width - elementRect.width);
                element.style.top = `${newTop}px`;
                element.style.left = `${newLeft}px`;
            } else if (isResizing) {
                let newWidth = startWidth, newHeight = startHeight, newTop = startTop, newLeft = startLeft;
                switch (currentHandle) {
                    case 'nw':
                        newWidth = startWidth - dx;
                        newHeight = startHeight - dy;
                        newLeft = startLeft + dx;
                        newTop = startTop + dy;
                        break;
                    case 'ne':
                        newWidth = startWidth + dx;
                        newHeight = startHeight - dy;
                        newTop = startTop + dy;
                        break;
                    case 'sw':
                        newWidth = startWidth - dx;
                        newHeight = startHeight + dy;
                        newLeft = startLeft + dx;
                        break;
                    case 'se':
                        newWidth = startWidth + dx;
                        newHeight = startHeight + dy;
                        break;
                    case 'n':
                        newHeight = startHeight - dy;
                        newTop = startTop + dy;
                        break;
                    case 'e':
                        newWidth = startWidth + dx;
                        break;
                    case 's':
                        newHeight = startHeight + dy;
                        break;
                    case 'w':
                        newWidth = startWidth - dx;
                        newLeft = startLeft + dx;
                        break;
                }

                if (newWidth > 10 && newHeight > 10) {
                    element.style.width = `${newWidth}px`;
                    element.style.height = `${newHeight}px`;
                    element.style.top = `${newTop}px`;
                    element.style.left = `${newLeft}px`;
                }
            }
        };

        const onMouseUp = () => {
            isDragging = false;
            isResizing = false;
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        };

        const onMouseDown = (e) => {
            if (e.target.dataset.resize) {
                isResizing = true;
                currentHandle = e.target.dataset.resize;
                startX = e.clientX;
                startY = e.clientY;
                startWidth = parseFloat(getComputedStyle(element).width);
                startHeight = parseFloat(getComputedStyle(element).height);
                startTop = parseFloat(getComputedStyle(element).top);
                startLeft = parseFloat(getComputedStyle(element).left);
            } else {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startTop = parseFloat(getComputedStyle(element).top);
                startLeft = parseFloat(getComputedStyle(element).left);
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        };

        element.addEventListener('mousedown', onMouseDown);
    };

    // Duplicate and initialize functionality for new elements
    const duplicateElement = () => {
        if (hoveredElement && hoveredElement.id !== "background") {
            const clone = hoveredElement.cloneNode(true);
            clone.setAttribute("class", "clone");
            clone.style.position = "absolute";
            clone.style.left = `${hoveredElement.offsetLeft + 10}px`;
            clone.style.top = `${hoveredElement.offsetTop + 10}px`;
            clone.style.zIndex = "10";
            background.appendChild(clone);

            makeDraggableAndResizable(clone); // Reinitialize draggable and resizable functionality

            // Add 8 resizing handles dynamically if not present
            const directions = ['nw', 'ne', 'sw', 'se', 'n', 'e', 's', 'w'];
            directions.forEach((direction) => {
                const handle = document.createElement('div');
                handle.dataset.resize = direction;
                handle.className = "clonehandle clonehandle1";
                handle.style.position = 'absolute';
                handle.style.width = '7px';
                handle.style.height = '7px';
                handle.style.background = '#0e4e46';
                handle.style.cursor = `${direction}-resize`;
                handle.style.display = "none";  // Hide by default
                switch (direction) {
                    case 'nw':
                        handle.style.top = '-5px';
                        handle.style.left = '-5px';
                        break;
                    case 'ne':
                        handle.style.top = '-5px';
                        handle.style.right = '-5px';
                        break;
                    case 'sw':
                        handle.style.bottom = '-5px';
                        handle.style.left = '-5px';
                        break;
                    case 'se':
                        handle.style.bottom = '-5px';
                        handle.style.right = '-5px';
                        break;
                    case 'n':
                        handle.style.top = '-5px';
                        handle.style.left = '50%';
                        handle.style.transform = 'translateX(-50%)';
                        break;
                    case 'e':
                        handle.style.top = '50%';
                        handle.style.right = '-5px';
                        handle.style.transform = 'translateY(-50%)';
                        break;
                    case 's':
                        handle.style.bottom = '-5px';
                        handle.style.left = '50%';
                        handle.style.transform = 'translateX(-50%)';
                        break;
                    case 'w':
                        handle.style.top = '50%';
                        handle.style.left = '-5px';
                        handle.style.transform = 'translateY(-50%)';
                        break;
                }
                clone.appendChild(handle);
            });

            // Show the handles when hovered
            clone.addEventListener('mouseenter', () => {
                const handles = clone.querySelectorAll('.clonehandle');
                handles.forEach(handle => handle.style.display = 'block');
            });

            clone.addEventListener('mouseleave', () => {
                const handles = clone.querySelectorAll('.clonehandle');
                handles.forEach(handle => handle.style.display = 'none');
            });
        }
    };

    // Listen to mouseover event to track hovered element
    document.addEventListener("mouseover", (e) => {
        if (e.target.matches("img, div") && e.target.id !== "background") {
            hoveredElement = e.target;
        }
    });

    // Listen to keyboard event for Ctrl+D duplication
    document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === 'd') {
            e.preventDefault();  // Prevent default behavior (e.g., browser duplicating tabs)
            duplicateElement();
        }

        // Listen to delete key for deleting hovered element
        if (e.key === 'Delete' ) { 
            // || e.key === 'Backspace'
            if (hoveredElement && hoveredElement.id !== "background") {
                hoveredElement.remove();
            }
        }
    });




    document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === 'z') {
            e.preventDefault();  // Prevent default behavior (e.g., undo in the browser)
            undoLastAction();
        }
    });

    // Undo the last action
    const undoLastAction = () => {
        if (history.length > 0) {
            const lastAction = history.pop();

            switch (lastAction.action) {
                case 'clone':
                    // Remove the last cloned element
                    background.removeChild(lastAction.element);
                    break;
                case 'resize':
                    // Undo the resize by reverting the styles to the original state
                    lastAction.element.style.cssText = lastAction.styles;
                    break;
                case 'delete':
                    // If a delete action was recorded, restore the element (if it was deleted)
                    break;
                // Add other cases if needed for additional actions
            }
        }
    };

</script>



    </body>
    </html>


    <input type="file" id="imageUpload" accept="image/*" />



    <!-- <script src="https://code.responsivevoice.org/responsivevoice.js?key=NVbGYm7d"></script> -->

    <script>



        let backgroundMain=document.getElementById("background")


        let popup =document.createElement("div")
        popup.className="popup"
       
        popup.style.width='200px'
        popup.style.height='250px'
        popup.style.border='0'
        popup.style.boxShadow = '1px 8px 24px 0px rgba(66, 68, 90, 1)'
        popup.style.borderRadius='15px'
        popup.style.zIndex='999'
        popup.style.transition = 'opacity 1s ease, visibility 1s ease';

        backgroundMain.appendChild(popup)



        let popupheader=document.createElement("div")
        popupheader.className="popupheader"
        popupheader.style.width='100%'
        popup.style.display='none'
        popupheader.style.height='30px'
     
           
        popupheader.style.display='grid'


        // popupheader.style.gridRow='1fr'
        //  popupheader.style.gridGap='14px'
         popupheader.style.gridTemplateColumns='1fr 1fr'


        popupheader.style.placeItems='end'

        
        
        


        // popupheader.innerHTML="<h5>Popup header</h5>"
        let headertext=document.createElement('span')
        headertext.style.fontSize='18px'
        headertext.style.fontWeight='bold'
        headertext.style.color='#000'
        // headertext.innerHTML='STYLE'
        popupheader.appendChild(headertext)

        
        popupheader.style.borderBottom='2px solid #f7f2f6'
        popupheader.fontSize='17px'
   
        popup.appendChild(popupheader)

        let closepopup=document.createElement("div")
        closepopup.className="closepopup"
        closepopup.innerHTML='X'
 
       
        closepopup.style.fontSize='12px'
        closepopup.style.cursor='pointer'
        closepopup.style.backgroundColor='white'
        closepopup.style.borderRadius='80%'
           popup.style.boxShadow = '1px 8px 24px 0px rgba(66, 68, 90, 1)'
        closepopup.style.color='#000'
        closepopup.style.position='relative'
        closepopup.style.top='-10px'
        closepopup.style.right='-10px'
        closepopup.style.padding='4px'


        let popupBody=document.createElement('div')
        popupBody.className="popupbody"
        popupBody.style.width='100%'
        popupBody.style.height='70%'
        popupBody.style.display='grid'
        popupBody.style.gridTemplateColumns='1fr 1fr  '
        popupBody.style.gridTemplateRows='1fr 1fr 1fr 1fr '

       
        // popupBody.style.gridGap='5px'
        popupBody.style.placeItems='start'
        

        popup.appendChild(popupBody)

        // let firtstcontainer=document.createElement('p')
        // firtstcontainer.className='first'
        // firtstcontainer.style.width='100%'
        // firtstcontainer.style.display

        
        

        const firstdiv=document.createElement("div")
        firstdiv.className="firstdiv"
        firstdiv.id='firstdiv'
        firstdiv.style.gridColumn = '-1 / -3';
        firstdiv.style.gridRow = '-5 / -1';
        firstdiv.style.display='grid'
        firstdiv.style.gridTemplateColumns='auto 1fr auto'
        firstdiv.style.alignItems='center'
        firstdiv.style.margin='5px'
        firstdiv.style.padding='10px'
        // firstdiv.style.backgroundColor='red'
        firstdiv.style.cursor='pointer'

    //     grid-column: -1 / -3;
    // grid-row: -5 / -1;
    // width: 100%;
        
        // firstdiv.style.backgroundColor='red'
        firstdiv.style.width='85%'
        // firstdiv.style.height='30%'

        firstdiv.style.borderBottom='2px solid #f7f2f6'
        popupBody.appendChild(firstdiv)

        // -1 / -3 / -5 / -1

        // -5 / -1 / -1 / -3


        let textcolor1=document.createElement('span')
        textcolor1.className='textcolor1'
        textcolor1.id='textcolor1'
        textcolor1.className='textcolor1'
        textcolor1.innerHTML=''
        textcolor1.style.borderRadius='80%'
        textcolor1.style.padding='10px'
        textcolor1.style.color='#f7f2f6'
        textcolor1.style.fontSize='18px'
        textcolor1.style.backgroundColor='black'
        
        firstdiv.appendChild(textcolor1)

        // let TextColorimage=document.createElement('img')
        // TextColorimage.src='images/icon/color.png' 
        // TextColorimage.style.width='4px'
        // TextColorimage.style.height='4px'
            
        // firstdiv.appendChild(TextColorimage)

        let spanColor=document.createElement('span')

        spanColor.innerHTML='Color'
        spanColor.className='spancolor'
        spanColor.id='spanColor'
        spanColor.innerHTML='Color'
        spanColor.style.fontSize='16px'
        spanColor.style.marginLeft='32%'

        firstdiv.appendChild(spanColor)


        let arrowicon=document.createElement("img")
        arrowicon.src="images/icon/fi-rr-angle-small-right.svg"
        arrowicon.style.width='20px'
        arrowicon.style.height='20px'
       
     
        
       


        firstdiv.appendChild(arrowicon)



        let seconddiv=document.createElement('div')
        seconddiv.className='seconddiv'
        seconddiv.id='seconddiv'
        seconddiv.style.display='grid'
        seconddiv.style.gridTemplateColumns='auto 1fr auto'
      
        seconddiv.style.borderBottom='2px solid #f7f2f6'
        seconddiv.style.alignItems='center'
        seconddiv.style.gridColumn = '-1 / -3';
        seconddiv.style.gridRow = '-4 / -1';
        seconddiv.style.gridGap='35px'
        seconddiv.style.alignItems='center'
          seconddiv.style.alignContent='start'

       
        seconddiv.style.cursor='pointer'
        seconddiv.style.width='85%'


        let seconddivicon=document.createElement('img')
        seconddivicon.src="images/icon/opacity.png"
        seconddivicon.style.width='35px'
        seconddivicon.style.height='35px'
        seconddivicon.style.marginLeft='10px'

        seconddiv.appendChild(seconddivicon)
        

        let seconddivtext=document.createElement('span')
        seconddivtext.className='seconddivtext'
        seconddivtext.id='seconddivtext'
     
          seconddivtext.innerHTML='Opacity'
          seconddivtext.style.fontSize='16px'
        //   seconddivtext.style.marginLeft='34%'
         
      


        seconddiv.appendChild(seconddivtext)

        let seconddivarrow=document.createElement('img')
        seconddivarrow.src="images/icon/fi-rr-angle-small-right.svg"
        seconddivarrow.style.width='20px'
        seconddivarrow.style.height='20px'
     
      
        seconddivarrow.style.cursor='pointer'
        seconddiv.appendChild(seconddivarrow)

        
       



        let secondpopup=document.createElement("div")
        secondpopup.id='secondpopup'
        secondpopup.className='secondpopup'


        secondpopup.style.display='grid'
        secondpopup.style.gridTemplateColumns='auto 1fr '
          secondpopup.style.gridTemplateRows='1fr 1fr'
        // secondpopup.style.gridGap='45%'
        secondpopup.style.backgroundColor='white'
        secondpopup.style.width='193px'
        secondpopup.style.height='73px'
        secondpopup.style.border='0'
        secondpopup.style.boxShadow = '2px 4px 10px rgba(0, 0, 0, 0.5)';
        secondpopup.style.borderRadius='15px'
        secondpopup.style.zIndex='999'
        secondpopup.style.transition = 'opacity 1s ease, visibility 1s ease';
       
        backgroundMain.appendChild(secondpopup)


        let secondpopupText=document.createElement('span')
        secondpopupText.id='secondpopupText'
        secondpopupText.className='secondpopupText'
        secondpopupText.innerHTML='Opacity'
        secondpopupText.style.fontSize='13px'
        
       
        secondpopup.appendChild(secondpopupText)

        let secondpopupPer=document.createElement('input')
        secondpopupPer.id='secondpopupPer'
        secondpopupPer.className='secondpopupPer'
        secondpopupPer.type='text'
        secondpopupPer.value='100%'
        secondpopupPer.style.border='none'
        
        secondpopupPer.style.width='100%'
        secondpopupPer.style.height='20px'
        secondpopupPer.style.borderRadius='20%'
        secondpopupPer.readOnly=true
       
        
        

        secondpopupPer.addEventListener('mouseover',function(){


            secondpopupPer.style.border='none'

        });
        secondpopupPer.addEventListener('focus',function(){
            secondpopupPer.style.border='none'
            secondpopupPer.style.outline='none'
           
        });

      
        
        

        let seconddivrange=document.createElement('input')
        seconddivrange.id='seconddivrange'
        seconddivrange.className='seconddivrange'
        seconddivrange.type='range'
        seconddivrange.min='10'
        seconddivrange.max='100'
        seconddivrange.value='100'
        seconddivrange.style.width='130%'
        seconddivrange.style.color='#6b055a'

        

      
        secondpopup.appendChild(secondpopupPer)
        secondpopup.appendChild(seconddivrange)

//         seconddiv.style.gridColumn='-1 /-3 '
//         seconddiv.style.gridRow=-'-4/-1'

//   seconddiv.style.width='85%'
//         seconddiv.style.padding='10px'
//          seconddiv.style.alignItems='center'
//             seconddiv.style.margin='5px'
      

        
        



        // seconddiv.style.display='grid'
        // seconddiv.style.gridTemplateColumns='auto 1fr auto'



        popupBody.appendChild(seconddiv)

    

        

       
        seconddiv.addEventListener('click',function(){
            secondpopup.style.opacity='1'
           
        })
        secondpopup.style.opacity='0'

        //     if (!popup.contains(event.target)) {
//         popup.style.display = 'none'; // Hide the popup
//     }

// document.addEventListener("click", (e) => {
//         if (!popup.contains(e.target)) {
//             popup.style.display = 'none';
//         }
//     });
//         document.addEventListener('click',(e)=>{
//             if(!secondpopup.contains(e.target)){

// secondpopup.style.opacity='0'
// }
            
//         })
      

        closepopup.addEventListener('click',()=>{

              // Add a scale effect and fade out the button
    popup.style.transform = 'scale(1)'; // Scale down the button
    popup.style.opacity = '0.2'; // Fade out the button
 


    // Optionally, you can also add a timeout to hide the popup after a short delay
    setTimeout(() => {
        popup.style.display = 'none'; // Hide the popup after the transition
    }, 200);

        })

        popupheader.appendChild(closepopup)


        //popup handles

                let backgroundcheck = document.getElementById("background");
                let selectedElement=null

        document.addEventListener("contextmenu", (e) => {
            // Check if the clicked element is inside the background div
            if (backgroundcheck.contains(e.target)) {
                e.preventDefault(); // Prevent the default right-click menu
                const clickedElement = e.target; // Element that was right-clicked

                console.log("Right-clicked element:", clickedElement);
                selectedElement=clickedElement
                selectedElementId=selectedElement.id

               
               
                let checkid=   selectedElement=clickedElement
            //   let checkid=  selectedElement.event.srcElement.id
              

                // Show the popup at the cursor position
                popup.style.opacity='1'
                popup.style.left = `${e.pageX}px`;
                popup.style.top = `${e.pageY}px`;
                popup.style.display = 'block';
            } else {
                // Allow default browser context menu for clicks outside background
                popup.style.display = 'none'; // Hide the popup if it is visible
            }
        });


        function moverange(){
        secondpopupPer.value = seconddivrange.value + '%'

        if (selectedElement) {
        // Normalize the slider value to a range between 0 and 1
        selectedElement.style.opacity = seconddivrange.value / 100;
    }
       }

       seconddivrange.addEventListener('mousedown',function(){
        document.addEventListener('mousemove',moverange)
           
       })



    // Hide popup if clicking outside of it
    document.addEventListener("click", (e) => {
        if (!popup.contains(e.target)) {
            popup.style.display = 'none';
        }
    });




   
    const colorPicker = document.getElementById('color-picker');
    const colorDisplay = document.getElementById('spanColor');
    const firstdiv1 = document.getElementById('firstdiv');
   





 



    // firstdiv1.addEventListener("mouseover", function() {
    //     // Programmatically trigger a click on the color picker
    //     colorPicker.click();
    // });

    firstdiv1.addEventListener("mouseout", function() {
        // Programmatically trigger a click on the color picker
        colorPicker.style.opacity='0'
       
    });


    // Add click event listener to the colorDisplay div
    firstdiv1.addEventListener("click", function() {
        // Programmatically trigger a click on the color picker
        colorPicker.click();
    });

  

    colorPicker.addEventListener("input", (event) => {
    if (selectedElement) {
        // Check if the element is contenteditable
        if (selectedElement.hasAttribute("contenteditable") && selectedElement.getAttribute("contenteditable") === "true") {
            // Change text color for contenteditable elements
            selectedElement.style.color = event.target.value;
        } 
        // Check if it's a div and not contenteditable
        else if (selectedElement.nodeName === "DIV" && 
                 (!selectedElement.hasAttribute("contenteditable") || selectedElement.getAttribute("contenteditable") !== "true")) {
            // Change background color for divs
            selectedElement.style.backgroundColor = event.target.value;
        }
    }
});


//     document.addEventListener('click', function(event) {
//     // Check if the click was outside the popup
//     if (!popup.contains(event.target)) {
//         popup.style.display = 'none'; // Hide the popup
//     }
// });

 
</script>

</body>

</html>